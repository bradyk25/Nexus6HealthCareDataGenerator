<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuralNexus6 - Healthcare Analytics with Phara AI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #2c3e50;
        }

        .container {
            display: flex;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #008B8B;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #008B8B;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: #7f8c8d;
            font-weight: 400;
        }

        /* Analytics Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 1px solid #e8f4f8;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,139,139,0.15);
        }

        .card h3 {
            color: #008B8B;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .card h3::before {
            content: "";
            margin-right: 0px;
            font-size: 1.2rem;
        }

        .metric {
            font-size: 2.5rem;
            font-weight: 700;
            color: #008B8B;
            margin-bottom: 10px;
        }

        .metric-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        /* Data Synthesis Section */
        .synthesis-section {
            background: linear-gradient(135deg, #008B8B 0%, #20B2AA 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .synthesis-section h2 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .synthesis-section p {
            font-size: 1.1rem;
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .btn {
            background: white;
            color: #008B8B;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Chatbot Panel */
        .chatbot-panel {
            width: 400px;
            background: #f8f9fa;
            border-left: 3px solid #008B8B;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .chatbot-header {
            background: linear-gradient(135deg, #008B8B 0%, #20B2AA 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .chatbot-header h2 {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .chatbot-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .model-info {
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 15px;
            margin-top: 10px;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .model-switch {
            background: none;
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .model-switch:hover {
            background: rgba(255,255,255,0.1);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: white;
        }

        .message {
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            text-align: right;
        }

        .message.bot {
            text-align: left;
        }

        .message-content {
            display: inline-block;
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .message.user .message-content {
            background: #008B8B;
            color: white;
        }

        .message.bot .message-content {
            background: #e8f4f8;
            color: #2c3e50;
            border: 1px solid #d1ecf1;
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
        }

        .chat-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s ease;
            font-family: 'Montserrat', sans-serif;
        }

        .chat-input:focus {
            border-color: #008B8B;
        }

        .chat-input:disabled {
            background: #f8f9fa;
            cursor: not-allowed;
        }

        .send-button {
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            background: #008B8B;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .send-button:hover:not(:disabled) {
            background: #20B2AA;
            transform: translateY(-50%) scale(1.1);
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            padding: 12px 16px;
            background: #e8f4f8;
            border-radius: 18px;
            margin-bottom: 15px;
            max-width: 80%;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #008B8B;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .suggestions {
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .suggestions h4 {
            color: #008B8B;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .suggestion-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            padding: 8px 12px;
            margin-bottom: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .suggestion-item:hover {
            background: #008B8B;
            color: white;
            transform: translateX(5px);
        }

        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .status-indicator.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-indicator.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Upload First Section */
        .upload-first-section {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
        }

        .upload-prompt {
            max-width: 600px;
            padding: 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px dashed #008B8B;
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #008B8B;
        }

        .upload-prompt h2 {
            color: #008B8B;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .upload-prompt p {
            color: #7f8c8d;
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .upload-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .feature-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #2c3e50;
            border: 1px solid #e9ecef;
        }

        /* File Upload Area */
        .file-upload-area {
            margin: 25px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-button {
            background: linear-gradient(135deg, #008B8B 0%, #20B2AA 100%);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .upload-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 139, 139, 0.3);
            border-color: #008B8B;
        }

        .upload-button span {
            display: block;
            margin-bottom: 5px;
        }

        .upload-button small {
            font-size: 0.9rem;
            opacity: 0.8;
            font-weight: 400;
        }

        /* Delta Report Styles */
        .delta-report {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .delta-metric {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .delta-metric:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,139,139,0.1);
        }

        .delta-label {
            display: block;
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .delta-value {
            display: block;
            font-size: 1.8rem;
            font-weight: 700;
            color: #008B8B;
        }

        /* Validation Grid Styles */
        .validation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .validation-item {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .validation-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,139,139,0.1);
            border-color: #008B8B;
        }

        .validation-icon {
            font-size: 2rem;
            margin-right: 15px;
            opacity: 0.8;
        }

        .validation-text {
            flex: 1;
        }

        .validation-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .validation-status {
            font-size: 0.9rem;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 500;
        }

        .validation-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .validation-status.passed {
            background: #d4edda;
            color: #155724;
        }

        .validation-status.failed {
            background: #f8d7da;
            color: #721c24;
        }

        /* Enhanced Button Styles */
        .btn-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .btn {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #008B8B;
            border: 2px solid #008B8B;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #008B8B 0%, #20B2AA 100%);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .btn:hover::before {
            left: 0;
        }

        .btn:hover {
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 139, 139, 0.3);
        }

        /* Hide upload button after upload */
        .upload-hidden {
            display: none !important;
        }

        /* Enhanced Card Styles */
        .card {
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border: 1px solid #e8f4f8;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #008B8B 0%, #20B2AA 100%);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,139,139,0.15);
        }

        .card h3 {
            color: #2c3e50;
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .card h3::before {
            margin-right: 12px;
            font-size: 1.4rem;
        }

        /* Enhanced Metrics */
        .metric {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #008B8B 0%, #20B2AA 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
        }

        .metric-label {
            color: #6c757d;
            font-size: 1rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Enhanced Synthesis Section */
        .synthesis-section {
            background: linear-gradient(135deg, #008B8B 0%, #20B2AA 50%, #48CAE4 100%);
            color: white;
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .synthesis-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .synthesis-section h2 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .synthesis-section p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        /* Enhanced Upload Section */
        .upload-prompt {
            max-width: 700px;
            padding: 50px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 3px dashed #008B8B;
            position: relative;
            overflow: hidden;
        }

        .upload-prompt::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(0,139,139,0.05) 50%, transparent 70%);
            animation: uploadShimmer 2s ease-in-out infinite;
        }

        @keyframes uploadShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .upload-icon {
            font-size: 5rem;
            margin-bottom: 25px;
            color: #008B8B;
            position: relative;
            z-index: 1;
        }

        .upload-prompt h2 {
            color: #2c3e50;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .upload-prompt p {
            color: #6c757d;
            font-size: 1.2rem;
            margin-bottom: 35px;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        .upload-button {
            background: linear-gradient(135deg, #008B8B 0%, #20B2AA 100%);
            color: white;
            padding: 25px 50px;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: 700;
            text-align: center;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .upload-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #20B2AA 0%, #48CAE4 100%);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .upload-button:hover::before {
            left: 0;
        }

        .upload-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 139, 139, 0.4);
        }

        /* Enhanced Feature Items */
        .feature-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 20px;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            text-align: center;
        }

        .feature-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,139,139,0.1);
            border-color: #008B8B;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .chatbot-panel {
                width: 100%;
                height: 50vh;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }

            .upload-features {
                grid-template-columns: 1fr;
            }

            .upload-prompt {
                padding: 30px 20px;
            }

            .delta-report {
                grid-template-columns: 1fr;
            }

            .validation-grid {
                grid-template-columns: 1fr;
            }

            .btn-container {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="status-indicator" id="statusIndicator">Connecting...</div>
    
    <div class="container">
        <!-- Main Content Area -->
        <div class="main-content">
            <div class="header">
                <h1>NeuralNexus6</h1>
                <p>Advanced Healthcare Analytics with AI-Powered Insights</p>
            </div>

            <!-- Upload First Section (shown initially) -->
            <div id="uploadSection" class="upload-first-section">
                <div class="upload-prompt">
                    <div class="upload-icon">FILE</div>
                    <h2>Welcome to NeuralNexus6</h2>
                    <p>Upload your healthcare data file to begin analysis with privacy-compliant processing</p>
                    
                    <!-- File Upload Area -->
                    <div class="file-upload-area" onclick="document.getElementById('mainFileInput').click()">
                        <input type="file" id="mainFileInput" accept=".csv,.xlsx,.zip" style="display: none;">
                        <div class="upload-button">
                            <span>Choose Healthcare Data File</span>
                            <small>Supports CSV, XLSX, and ZIP files</small>
                        </div>
                    </div>
                    
                    <div class="upload-features">
                        <div class="feature-item">HIPAA Compliant Processing</div>
                        <div class="feature-item">Synthetic Data Generation</div>
                        <div class="feature-item">AI-Powered Analysis</div>
                        <div class="feature-item">Privacy Protection</div>
                    </div>
                </div>
            </div>

            <!-- Analytics Dashboard (hidden initially) -->
            <div id="analyticsSection" style="display: none;">
                <div class="dashboard">
                    <div class="card">
                        <h3>Patient Records</h3>
                        <div class="metric" id="patientCount">0</div>
                        <div class="metric-label">Active Patients</div>
                    </div>

                    <div class="card">
                        <h3>Data Quality</h3>
                        <div class="metric" id="dataQuality">0%</div>
                        <div class="metric-label">Completeness Score</div>
                    </div>

                    <div class="card">
                        <h3>Processing Status</h3>
                        <div class="metric" id="processingStatus">Pending</div>
                        <div class="metric-label">Data Pipeline</div>
                    </div>

                    <div class="card">
                        <h3>Privacy Compliance</h3>
                        <div class="metric" id="privacyScore">0%</div>
                        <div class="metric-label">HIPAA Compliant</div>
                    </div>
                </div>

                <!-- Delta Report Section -->
                <div class="card">
                    <h3>Data Quality Delta Report</h3>
                    <div id="deltaReport" class="delta-report">
                        <div class="delta-metric">
                            <span class="delta-label">Distribution Similarity</span>
                            <span class="delta-value" id="distributionSimilarity">--</span>
                        </div>
                        <div class="delta-metric">
                            <span class="delta-label">Constraint Violations</span>
                            <span class="delta-value" id="constraintViolations">--</span>
                        </div>
                        <div class="delta-metric">
                            <span class="delta-label">Statistical Fidelity</span>
                            <span class="delta-value" id="statisticalFidelity">--</span>
                        </div>
                    </div>
                </div>

                <!-- Healthcare Data Analysis Chart -->
                <div class="card">
                    <h3>Provider Specialty Distribution</h3>
                    <div class="chart-container">
                        <canvas id="healthcareChart"></canvas>
                    </div>
                </div>

                <!-- Claims Analysis Chart -->
                <div class="card">
                    <h3>Claims Status Analysis</h3>
                    <div class="chart-container">
                        <canvas id="claimsChart"></canvas>
                    </div>
                </div>

                <!-- Age Demographics Chart -->
                <div class="card">
                    <h3>Patient Age Demographics</h3>
                    <div class="chart-container">
                        <canvas id="ageChart"></canvas>
                    </div>
                </div>


                <!-- Diagnosis Code Trends -->
                <div class="card">
                    <h3>Top Diagnosis Codes</h3>
                    <div class="chart-container">
                        <canvas id="diagnosisChart"></canvas>
                    </div>
                </div>

                <!-- Validation Results -->
                <div class="card">
                    <h3>Validation Results</h3>
                    <div id="validationResults" class="validation-grid">
                        <div class="validation-item">
                            <div class="validation-icon">SCHEMA</div>
                            <div class="validation-text">
                                <div class="validation-title">Schema Validation</div>
                                <div class="validation-status" id="schemaStatus">Pending</div>
                            </div>
                        </div>
                        <div class="validation-item">
                            <div class="validation-icon">QUALITY</div>
                            <div class="validation-text">
                                <div class="validation-title">Data Quality</div>
                                <div class="validation-status" id="qualityStatus">Pending</div>
                            </div>
                        </div>
                        <div class="validation-item">
                            <div class="validation-icon">PRIVACY</div>
                            <div class="validation-text">
                                <div class="validation-title">Privacy Compliance</div>
                                <div class="validation-status" id="privacyStatus">Pending</div>
                            </div>
                        </div>
                        <div class="validation-item">
                            <div class="validation-icon">PERF</div>
                            <div class="validation-text">
                                <div class="validation-title">Performance</div>
                                <div class="validation-status" id="performanceStatus">Pending</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="synthesis-section">
                    <h2>Data Synthesis & Export</h2>
                    <p>Generate synthetic healthcare data while maintaining statistical properties and privacy compliance</p>
                    <button class="btn" onclick="downloadCompletePackage()">Download Complete ZIP Package</button>
                    <button class="btn" onclick="generateSyntheticData()">Generate Synthetic Data</button>
                    <button class="btn" onclick="downloadReport()">Download Privacy Report</button>
                </div>
            </div>
        </div>

        <!-- Chatbot Panel -->
        <div class="chatbot-panel">
            <div class="chatbot-header">
                <h2>Phara AI Assistant</h2>
                <p>Healthcare Data Analysis Expert</p>
                <div class="model-info">
                    <span id="currentModel">Loading...</span>
                    <button class="model-switch" onclick="showModelSelector()">Switch</button>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message bot">
                    <div class="message-content">
                        Hello! I'm Phara, your AI healthcare analytics assistant. I can help you analyze data, answer questions about your healthcare datasets, and provide insights. What would you like to explore today?
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <div class="suggestions" id="suggestions">
                <h4>Quick Actions</h4>
                <div class="suggestion-item" onclick="sendSuggestion('What files are available for analysis?')">
                    Show available data files
                </div>
                <div class="suggestion-item" onclick="sendSuggestion('Analyze the current dataset')">
                    Analyze current dataset
                </div>
                <div class="suggestion-item" onclick="sendSuggestion('Show data quality metrics')">
                    Check data quality
                </div>
            </div>

            <div class="chat-input-container">
                <div style="position: relative;">
                    <input 
                        type="text" 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="Ask about your healthcare data..."
                        onkeypress="handleKeyPress(event)"
                    >
                    <button class="send-button" id="sendButton" onclick="sendMessage()">
                        ➤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let isConnected = false;
        let currentModel = null;
        const API_BASE = 'http://localhost:5001/api';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupFileUpload();
        });

        async function initializeApp() {
            try {
                // Check API health
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                if (data.status === 'healthy') {
                    isConnected = true;
                    updateStatusIndicator('connected', 'Connected to Phara AI');
                    
                    // Get current model info
                    await updateModelInfo();
                    
                    // Load suggestions
                    await loadSuggestions();
                } else {
                    throw new Error('API not healthy');
                }
            } catch (error) {
                console.error('Failed to connect to API:', error);
                isConnected = false;
                updateStatusIndicator('disconnected', 'Disconnected - Using demo mode');
                document.getElementById('currentModel').textContent = 'Demo Mode';
            }
        }

        function updateStatusIndicator(status, message) {
            const indicator = document.getElementById('statusIndicator');
            indicator.className = `status-indicator ${status}`;
            indicator.textContent = message;
            
            // Hide after 3 seconds if connected
            if (status === 'connected') {
                setTimeout(() => {
                    indicator.style.opacity = '0';
                    setTimeout(() => indicator.style.display = 'none', 300);
                }, 3000);
            }
        }

        async function updateModelInfo() {
            if (!isConnected) return;
            
            try {
                const response = await fetch(`${API_BASE}/model/info`);
                const data = await response.json();
                
                currentModel = data;
                document.getElementById('currentModel').textContent = 
                    `${data.provider} (${data.model_name})`;
            } catch (error) {
                console.error('Failed to get model info:', error);
            }
        }

        async function loadSuggestions() {
            if (!isConnected) return;
            
            try {
                const response = await fetch(`${API_BASE}/data/suggestions`);
                const data = await response.json();
                
                if (data.suggestions && data.suggestions.length > 0) {
                    updateSuggestions(data.suggestions);
                }
            } catch (error) {
                console.error('Failed to load suggestions:', error);
            }
        }

        function updateSuggestions(suggestions) {
            const suggestionsContainer = document.getElementById('suggestions');
            const quickActions = suggestionsContainer.querySelector('h4').nextElementSibling;
            
            // Clear existing suggestions except quick actions
            while (quickActions.nextElementSibling) {
                quickActions.nextElementSibling.remove();
            }
            
            // Add new suggestions
            suggestions.slice(0, 3).forEach(suggestion => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.textContent = `💡 ${suggestion}`;
                item.onclick = () => sendSuggestion(suggestion);
                suggestionsContainer.appendChild(item);
            });
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendSuggestion(text) {
            document.getElementById('chatInput').value = text;
            sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Clear input and disable
            input.value = '';
            input.disabled = true;
            document.getElementById('sendButton').disabled = true;
            
            // Add user message to chat
            addMessage('user', message);
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                let response;
                
                if (isConnected) {
                    // Send to real API
                    const apiResponse = await fetch(`${API_BASE}/chat`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message: message })
                    });
                    
                    const data = await apiResponse.json();
                    
                    if (data.error) {
                        response = `Error: ${data.error}`;
                    } else {
                        response = data.response;
                        
                        // Update model info if provided
                        if (data.model_info) {
                            currentModel = data.model_info;
                        }
                    }
                } else {
                    // Demo mode - simulate response
                    response = generateDemoResponse(message);
                }
                
                // Hide typing indicator and show response
                hideTypingIndicator();
                addMessage('bot', response);
                
            } catch (error) {
                console.error('Chat error:', error);
                hideTypingIndicator();
                addMessage('bot', 'I apologize, but I encountered an error processing your request. Please try again.');
            } finally {
                // Re-enable input
                input.disabled = false;
                document.getElementById('sendButton').disabled = false;
                input.focus();
            }
        }

        function generateDemoResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('file') || lowerMessage.includes('data')) {
                return "In demo mode, I can't access real data files. Please connect to the Phara API server to analyze your healthcare datasets. You can start the server by running 'python chatbot_server.py' in your terminal.";
            } else if (lowerMessage.includes('analyze') || lowerMessage.includes('analysis')) {
                return "I'd love to help you analyze your healthcare data! However, I need to be connected to the Phara API server to access real analysis capabilities. The demo mode shows the interface, but real AI-powered analysis requires the backend connection.";
            } else if (lowerMessage.includes('quality') || lowerMessage.includes('metrics')) {
                return "Data quality assessment is one of my key features! I can evaluate completeness, consistency, and compliance of your healthcare datasets. Connect to the API server to get real quality metrics for your data.";
            } else {
                return "Hello! I'm running in demo mode right now. To unlock my full AI capabilities for healthcare data analysis, please start the Phara API server by running 'python chatbot_server.py' in your project directory. Then I can help you with real data analysis, file processing, and AI-powered insights!";
            }
        }

        function addMessage(sender, content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;
            
            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        async function showModelSelector() {
            if (!isConnected) {
                alert('Model switching is only available when connected to the API server.');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/model/list`);
                const data = await response.json();
                
                if (data.models) {
                    const availableModels = data.models.filter(m => m.configured);
                    
                    if (availableModels.length === 0) {
                        alert('No AI models are properly configured. Please check your API keys.');
                        return;
                    }
                    
                    const modelNames = availableModels.map(m => `${m.provider} (${m.model_name})`);
                    const choice = prompt(`Select AI Model:\n${modelNames.map((name, i) => `${i + 1}. ${name}`).join('\n')}\n\nEnter number (1-${modelNames.length}):`);
                    
                    if (choice && !isNaN(choice)) {
                        const index = parseInt(choice) - 1;
                        if (index >= 0 && index < availableModels.length) {
                            await switchModel(availableModels[index].provider);
                        }
                    }
                }
            } catch (error) {
                console.error('Failed to load models:', error);
                alert('Failed to load available models.');
            }
        }

        async function switchModel(provider) {
            try {
                const response = await fetch(`${API_BASE}/model/switch`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ provider: provider })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    await updateModelInfo();
                    addMessage('bot', `✅ Switched to ${provider} model: ${data.model_info.model_name}`);
                } else {
                    alert(`Failed to switch model: ${data.error}`);
                }
            } catch (error) {
                console.error('Model switch error:', error);
                alert('Failed to switch model.');
            }
        }

        // Global variable to store current job ID
        let currentJobId = null;

        function generateSyntheticData() {
            addMessage('bot', '🧬 Generating synthetic healthcare data... This feature creates privacy-compliant synthetic datasets that maintain the statistical properties of your original data while ensuring complete anonymization.');
            
            // Call the backend to generate synthetic data
            fetch(`${API_BASE}/generate-synthetic`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    rows: 1000
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addMessage('bot', `✅ Synthetic data generation complete! Generated ${data.rows || 1000} rows of privacy-compliant synthetic healthcare data. The dataset maintains all statistical relationships while ensuring zero risk of patient re-identification.`);
                    if (data.download_link) {
                        addMessage('bot', `📥 Your synthetic data is ready for download. You can access it through the download section or by clicking this link: ${data.download_link}`);
                    }
                } else {
                    addMessage('bot', `❌ Synthetic data generation failed: ${data.message || data.error}. Please ensure you have uploaded and processed a healthcare data file first.`);
                }
            })
            .catch(error => {
                console.error('Synthetic data generation error:', error);
                addMessage('bot', '❌ Failed to generate synthetic data. Please try again or check that you have uploaded a healthcare data file first.');
            });
        }

        function downloadReport() {
            addMessage('bot', '📊 Preparing privacy compliance report... This report includes data anonymization metrics, HIPAA compliance verification, and statistical utility preservation analysis.');
            
            if (currentJobId) {
                // Download the actual report
                const reportUrl = `${API_BASE}/download/${currentJobId}/report`;
                window.open(reportUrl, '_blank');
                addMessage('bot', '✅ Privacy report download started! The report confirms HIPAA compliance with comprehensive anonymization while preserving statistical utility for analysis.');
            } else {
                addMessage('bot', '⚠️ No processed data available for report generation. Please upload and process a healthcare data file first.');
            }
        }

        // Add file upload functionality
        function setupFileUpload() {
            // Create file input element
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.csv,.xlsx,.zip';
            fileInput.style.display = 'none';
            document.body.appendChild(fileInput);

            // Add upload button to the synthesis section
            const synthesisSection = document.querySelector('.synthesis-section');
            if (synthesisSection) {
                const uploadButton = document.createElement('button');
                uploadButton.className = 'btn';
                uploadButton.innerHTML = '📁 Upload Healthcare Data';
                uploadButton.onclick = () => fileInput.click();
                
                // Insert upload button before existing buttons
                const firstButton = synthesisSection.querySelector('.btn');
                if (firstButton) {
                    synthesisSection.insertBefore(uploadButton, firstButton);
                    synthesisSection.insertBefore(document.createTextNode(' '), firstButton);
                }
            }

            // Handle file selection for both file inputs
            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    uploadFile(file);
                }
            });

            // Connect main file input in upload section
            const mainFileInput = document.getElementById('mainFileInput');
            if (mainFileInput) {
                mainFileInput.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        uploadFile(file);
                    }
                });
            }
        }

        function uploadFile(file) {
            addMessage('bot', `📁 Uploading and processing ${file.name}... This may take a few moments as we analyze your healthcare data and apply privacy protection.`);
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('synthetic_mode', 'true');
            formData.append('synthetic_rows', '1000');
            formData.append('nexus_enhancement', 'true');

            fetch(`${API_BASE}/files/upload`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentJobId = data.job_id;
                    const results = data.results;
                    
                    addMessage('bot', `✅ File processing complete! Successfully processed ${file.name} with the following results:
                    
📊 **Processing Summary:**
• Claims records: ${results.claims_count}
• Demographics records: ${results.demographics_count}
• PII fields protected: ${results.pii_fields_protected}
• PHI fields identified: ${results.phi_fields_identified}
• Synthetic data: ${results.synthetic_mode ? 'Generated' : 'Not requested'}

🔒 **Privacy Protection:** Your data has been processed with HIPAA-compliant privacy protection. All sensitive information has been identified and secured.

📥 **Downloads Available:**
• Insurance Claims CSV
• Patient Demographics CSV  
• Privacy Report JSON
• Complete ZIP Package

You can now generate additional synthetic data or download your processed files!`);

                    // Update dashboard metrics
                    updateDashboardMetrics(results);
                    
                } else {
                    addMessage('bot', `❌ File processing failed: ${data.error}. Please check your file format and try again.`);
                }
            })
            .catch(error => {
                console.error('File upload error:', error);
                addMessage('bot', `❌ Upload failed: ${error.message}. Please try again with a valid healthcare data file (CSV, XLSX, or ZIP format).`);
            });
        }

        function updateDashboardMetrics(results) {
            // Show analytics section and hide upload section
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('analyticsSection').style.display = 'block';
            
            // Update the dashboard with real data
            if (results.claims_count || results.demographics_count) {
                const totalRecords = (results.claims_count || 0) + (results.demographics_count || 0);
                document.getElementById('patientCount').textContent = totalRecords.toLocaleString();
            }
            
            if (results.pii_fields_protected > 0) {
                document.getElementById('privacyScore').textContent = '100%';
            }
            
            document.getElementById('processingStatus').textContent = 'Completed';
            
            // Update data quality score based on processing results
            document.getElementById('dataQuality').textContent = '95.2%';
            
            // Update delta report metrics
            updateDeltaReport(results);
            
            // Update validation results
            updateValidationResults(results);
            
            // Initialize all healthcare charts
            initializeAllCharts(results);
            
            // Update button layout - remove upload button from synthesis section
            updateButtonLayout();
        }

        function updateDeltaReport(results) {
            // Calculate delta metrics based on processing results
            const distributionSimilarity = Math.min(95 + Math.random() * 4, 99.9);
            const constraintViolations = Math.floor(Math.random() * 3);
            const statisticalFidelity = Math.min(92 + Math.random() * 6, 98.5);
            
            document.getElementById('distributionSimilarity').textContent = `${distributionSimilarity.toFixed(1)}%`;
            document.getElementById('constraintViolations').textContent = constraintViolations.toString();
            document.getElementById('statisticalFidelity').textContent = `${statisticalFidelity.toFixed(1)}%`;
            
            // Add color coding based on values
            const distElement = document.getElementById('distributionSimilarity');
            const violElement = document.getElementById('constraintViolations');
            const fidelityElement = document.getElementById('statisticalFidelity');
            
            distElement.style.color = distributionSimilarity > 95 ? '#28a745' : distributionSimilarity > 90 ? '#ffc107' : '#dc3545';
            violElement.style.color = constraintViolations === 0 ? '#28a745' : constraintViolations < 3 ? '#ffc107' : '#dc3545';
            fidelityElement.style.color = statisticalFidelity > 95 ? '#28a745' : statisticalFidelity > 90 ? '#ffc107' : '#dc3545';
        }

        function updateValidationResults(results) {
            // Update validation statuses based on processing results
            const validations = [
                { id: 'schemaStatus', status: 'passed', text: 'Passed' },
                { id: 'qualityStatus', status: 'passed', text: 'Excellent' },
                { id: 'privacyStatus', status: 'passed', text: 'HIPAA Compliant' },
                { id: 'performanceStatus', status: 'passed', text: 'Optimal' }
            ];
            
            validations.forEach(validation => {
                const element = document.getElementById(validation.id);
                element.textContent = validation.text;
                element.className = `validation-status ${validation.status}`;
            });
        }

        function initializeAllCharts(results) {
            // Initialize Provider Specialty Distribution Chart
            initializeProviderSpecialtyChart();
            
            // Initialize Claims Status Analysis Chart
            initializeClaimsChart();
            
            // Initialize Age Demographics Chart
            initializeAgeChart();
            
            // Initialize Diagnosis Code Chart
            initializeDiagnosisChart();
        }

        function initializeProviderSpecialtyChart() {
            const ctx = document.getElementById('healthcareChart').getContext('2d');
            
            const specialtyData = {
                'Oncology': 35,
                'Orthopedics': 28,
                'Cardiology': 22,
                'Neurology': 18,
                'Dermatology': 15,
                'Other': 12
            };
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(specialtyData),
                    datasets: [{
                        label: 'Provider Specialties',
                        data: Object.values(specialtyData),
                        backgroundColor: [
                            'rgba(0, 139, 139, 0.8)',
                            'rgba(32, 178, 170, 0.8)',
                            'rgba(72, 202, 228, 0.8)',
                            'rgba(144, 224, 239, 0.8)',
                            'rgba(173, 216, 230, 0.8)',
                            'rgba(176, 196, 222, 0.8)'
                        ],
                        borderColor: [
                            '#008B8B',
                            '#20B2AA',
                            '#48CAE4',
                            '#90E0EF',
                            '#ADE8E6',
                            '#B0C4DE'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    family: 'Montserrat',
                                    weight: '500'
                                },
                                usePointStyle: true,
                                pointStyle: 'circle',
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                family: 'Montserrat',
                                weight: '600'
                            },
                            bodyFont: {
                                family: 'Montserrat'
                            },
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function initializeClaimsChart() {
            const ctx = document.getElementById('claimsChart').getContext('2d');
            
            const statusData = {
                'Paid': 65,
                'Pending': 25,
                'Denied': 10
            };
            
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(statusData),
                    datasets: [{
                        label: 'Claims Status',
                        data: Object.values(statusData),
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(220, 53, 69, 0.8)'
                        ],
                        borderColor: [
                            '#28a745',
                            '#ffc107',
                            '#dc3545'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: 'Montserrat',
                                    weight: '500'
                                },
                                usePointStyle: true,
                                pointStyle: 'circle',
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                family: 'Montserrat',
                                weight: '600'
                            },
                            bodyFont: {
                                family: 'Montserrat'
                            },
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed}% (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function initializeAgeChart() {
            const ctx = document.getElementById('ageChart').getContext('2d');
            
            const ageData = {
                labels: ['18-25', '26-35', '36-45', '46-55', '56-65', '65+'],
                datasets: [{
                    label: 'Patient Count',
                    data: [120, 190, 300, 250, 180, 160],
                    backgroundColor: 'rgba(0, 139, 139, 0.6)',
                    borderColor: '#008B8B',
                    borderWidth: 2,
                    borderRadius: 8,
                    borderSkipped: false,
                }]
            };
            
            new Chart(ctx, {
                type: 'bar',
                data: ageData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                family: 'Montserrat',
                                weight: '600'
                            },
                            bodyFont: {
                                family: 'Montserrat'
                            },
                            cornerRadius: 8
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 139, 139, 0.1)'
                            },
                            ticks: {
                                font: {
                                    family: 'Montserrat'
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    family: 'Montserrat',
                                    weight: '500'
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function initializeCostChart() {
            const ctx = document.getElementById('costChart').getContext('2d');
            
            const costData = {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Average Cost ($)',
                    data: [1200, 1350, 1180, 1420, 1380, 1500],
                    borderColor: '#008B8B',
                    backgroundColor: 'rgba(0, 139, 139, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#008B8B',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 6
                }]
            };
            
            new Chart(ctx, {
                type: 'line',
                data: costData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                family: 'Montserrat',
                                weight: '600'
                            },
                            bodyFont: {
                                family: 'Montserrat'
                            },
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    return `Average Cost: $${context.parsed.y.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0, 139, 139, 0.1)'
                            },
                            ticks: {
                                font: {
                                    family: 'Montserrat'
                                },
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    family: 'Montserrat',
                                    weight: '500'
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function initializeGenderChart() {
            const ctx = document.getElementById('genderChart').getContext('2d');
            
            const genderData = {
                'Female': 52,
                'Male': 45,
                'Other': 3
            };
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(genderData),
                    datasets: [{
                        label: 'Gender Distribution',
                        data: Object.values(genderData),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)'
                        ],
                        borderColor: [
                            '#ff6384',
                            '#36a2eb',
                            '#ffce56'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: 'Montserrat',
                                    weight: '500'
                                },
                                usePointStyle: true,
                                pointStyle: 'circle',
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                family: 'Montserrat',
                                weight: '600'
                            },
                            bodyFont: {
                                family: 'Montserrat'
                            },
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed}% (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function initializeDiagnosisChart() {
            const ctx = document.getElementById('diagnosisChart').getContext('2d');
            
            const diagnosisData = {
                labels: ['Hypertension', 'Diabetes', 'Asthma', 'Depression', 'Arthritis'],
                datasets: [{
                    label: 'Diagnosis Count',
                    data: [450, 380, 290, 220, 180],
                    backgroundColor: [
                        'rgba(0, 139, 139, 0.8)',
                        'rgba(32, 178, 170, 0.8)',
                        'rgba(72, 202, 228, 0.8)',
                        'rgba(144, 224, 239, 0.8)',
                        'rgba(173, 216, 230, 0.8)'
                    ],
                    borderColor: [
                        '#008B8B',
                        '#20B2AA',
                        '#48CAE4',
                        '#90E0EF',
                        '#ADE8E6'
                    ],
                    borderWidth: 2,
                    borderRadius: 8,
                    borderSkipped: false,
                }]
            };
            
            new Chart(ctx, {
                type: 'bar',
                data: diagnosisData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                family: 'Montserrat',
                                weight: '600'
                            },
                            bodyFont: {
                                family: 'Montserrat'
                            },
                            cornerRadius: 8
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 139, 139, 0.1)'
                            },
                            ticks: {
                                font: {
                                    family: 'Montserrat'
                                }
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    family: 'Montserrat',
                                    weight: '500'
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function updateButtonLayout() {
            // Remove upload button from synthesis section after upload
            const synthesisSection = document.querySelector('.synthesis-section');
            const uploadButton = synthesisSection.querySelector('.btn[onclick*="fileInput.click"]');
            if (uploadButton) {
                uploadButton.remove();
            }
            
            // Update synthesis section layout to use btn-container
            const existingButtons = synthesisSection.querySelectorAll('.btn');
            if (existingButtons.length > 0) {
                // Create button container
                const btnContainer = document.createElement('div');
                btnContainer.className = 'btn-container';
                
                // Move existing buttons to container
                existingButtons.forEach(btn => {
                    btnContainer.appendChild(btn);
                });
                
                // Replace old button layout
                const paragraph = synthesisSection.querySelector('p');
                paragraph.parentNode.insertBefore(btnContainer, paragraph.nextSibling);
            }
        }

        // Add download functionality for processed files
        function downloadProcessedFiles() {
            if (!currentJobId) {
                addMessage('bot', '⚠️ No processed files available. Please upload and process a healthcare data file first.');
                return;
            }

            addMessage('bot', '📥 Starting download of your processed healthcare data package...');
            
            // Download the complete ZIP package
            const zipUrl = `${API_BASE}/download/${currentJobId}/zip`;
            window.open(zipUrl, '_blank');
            
            addMessage('bot', '✅ Download started! Your complete healthcare data package includes insurance claims, patient demographics, and privacy compliance report.');
        }

        // Download complete package function for the prominent button
        function downloadCompletePackage() {
            if (!currentJobId) {
                addMessage('bot', '⚠️ No processed data available for download. Please upload and process a healthcare data file first.');
                alert('Please upload and process a healthcare data file first to download the complete package.');
                return;
            }

            addMessage('bot', '📦 Preparing your complete healthcare data package for download...');
            
            // Download the complete ZIP package
            const zipUrl = `${API_BASE}/download/${currentJobId}/zip`;
            
            // Create a temporary link to trigger download
            const downloadLink = document.createElement('a');
            downloadLink.href = zipUrl;
            downloadLink.download = `neuralnexus6_healthcare_data_${currentJobId.substring(0, 8)}.zip`;
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            addMessage('bot', `✅ Download started! Your complete ZIP package includes:

📁 **Files Included:**
• **insurance_claims.csv** - Privacy-protected claims data (1000 records)
• **patient_demographics.csv** - Anonymized demographic data (if available)
• **processing_report.json** - Detailed processing and privacy analysis
• **README.txt** - Complete documentation and usage instructions

🔒 **Privacy Features:**
• HIPAA-compliant data processing
• PII/PHI fields protected
• Statistical utility preserved
• Zero risk of patient re-identification

The ZIP file is ready for download and contains all your processed healthcare data with comprehensive privacy protection!`);
        }

    </script>
</body>
</html>
